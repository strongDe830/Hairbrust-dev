window.Herd.SparkElement=function({SuperClass:e=HTMLElement}={}){return class extends e{static get requiredElements(){return[]}static get requiredExternalElements(){return[]}static get requiredAttributes(){return[]}constructor(){super(),this._hasBeenInitialised=!1,this.sections=[],this.els=this.getElements(this._getElementIdentifiers()),this.externalEls=this.getElements(this._getExternalElementIdentifiers(),this._externalElIdentifier,{context:document}),this.listeners=new window.Herd.Listeners,this.checkValidity()}connectedCallback(){this._hasBeenInitialised||(this._hasBeenInitialised=!0,this.setupListeners())}disconnectedCallback(){this.listeners.removeAll()}checkValidity(){if(0===this.constructor.requiredElements.length&&0===this.constructor.requiredExternalElements.length&&0===this.constructor.requiredAttributes.length)return;const e=this.constructor.requiredElements.filter((e=>!(e in this.els))),t=this.constructor.requiredExternalElements.filter((e=>!(e in this.externalEls))),i=this.constructor.requiredAttributes.filter((e=>!this.getAttributeNames().includes(e)));if(0===e.length&&0===t.length&&0===i.length)return;i.forEach((e=>{this.throwError(`needs a '${e}' attribute`)}));const r=e.map((e=>`- ${this._elIdentifier}="${e}"`)).join("\n"),n=t.map((e=>`- ${this._externalElIdentifier}="${e}"`)).join("\n"),s=i.map((e=>`- ${e}`)).join("\n");let l="Has errors, please read below";e.length>0&&(l+=`\n          Missing required elements:\n          ${r}\n        `),t.length>0&&(l+=`\n          Missing external required elements:\n          ${n}\n        `),i.length>0&&(l+=`\n          Missing required attributes:\n          ${s}\n        `),this.throwError(l)}throwError(e){throw`<${this.identifier}>: ${e}`}setupListeners(){}getElements(e,t=this._elIdentifier,{context:i=this}={}){return e.reduce(((e,r)=>{const n=r.split(" ");return n.forEach((s=>{const l=(()=>{const e=n.length>1?"*=":"=",i=n.length>1?s:r;return this.key&&t===this._externalElIdentifier?`[${t}${e}"${i}"][key="${this.key}"]`:`[${t}${e}"${i}"]`})(),h=Array.from(i.querySelectorAll(l));e[s]={exists:h.length>0,elements:h,element:h[0],selector:l}})),e}),{})}_upgradeProperty(e){if(this.hasOwnProperty(e)){const t=this[e];delete this[e],this[e]=t}}_getElementIdentifiers(){return Array.from(this.querySelectorAll(`[${this._elIdentifier}]`)).map((e=>e.getAttribute(this._elIdentifier)))}_getExternalElementIdentifiers(){const e=this.key?`[${this._externalElIdentifier}][key="${this.key}"]`:`[${this._externalElIdentifier}]`;return Array.from(document.querySelectorAll(e)).map((e=>e.getAttribute(this._externalElIdentifier)))}renderSections(e){if(0===this.sections.length)return;const t=this.sections.filter((t=>t.section in e)).map((t=>Object.assign({},t,{html:e[t.section]})));window.Herd.utils.sectionRenderer.renderMultiple(t)}get identifier(){const e=this.hasAttribute("is")?this.getAttribute("is"):this.localName.toLowerCase();return this.key&&this.key.trim().length?`${e}-${this.key.toLowerCase()}`:e}get debug(){return window.theme.isDevTheme}get key(){return this.getAttribute("key")}get hasBeenInitialised(){return this._hasBeenInitialised}get _elIdentifier(){return`data-${this.identifier}-el`}get _externalElIdentifier(){return`data-${this.identifier}-external-el`}}};