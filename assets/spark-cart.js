(()=>{const t=location.pathname+location.search;window.Herd.Cart=new class{async addItem({id:e,quantity:i=1,properties:n={},sellingPlan:r=null},d,{sections:o=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),sectionsUrl:a=t,attributes:s={}}){let w={id:e,quantity:i,properties:n,selling_plan:r};if(n._limit_quantity)try{const t=(await window.Herd.utils.fetchJSON("/cart.js",{headers:{Accept:"application/json","Content-Type":"application/json"}})).items.find((t=>t.product_id===Number(n._product_id)));if(t)return window.drawers.activeDrawerKey="push-cart",void(this.cartError=window.cartStrings.quantityError.replace("[quantity]",1))}catch(t){}this.cartError="",w=this.addVatRateToItem(w),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.BEFORE_ADD,{item:w,attributes:s,form:d});const c={items:[w],attributes:s};try{const t=await this.cartAdd(c);return o.length&&(t.sections=await window.Herd.utils.sectionRenderer.fetch(o,a)),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.AFTER_ADD,{item:w,state:t,form:d}),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.CHANGED,{state:t}),t}catch(t){}}async addItems(e,{sections:i=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),sectionsUrl:n=t}={}){window.Herd.dispatchEvent(window.Herd.EVENTS.CART.BEFORE_MULTIPLE_ADD,{items:e});const r={items:e=e.map((t=>this.addVatRateToItem(t)))};try{const t=await this.cartAdd(r);return i.length&&(t.sections=await window.Herd.utils.sectionRenderer.fetch(i,n)),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.AFTER_MULTIPLE_ADD,{state:t}),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.CHANGED,{state:t}),t}catch(t){}}async updateQuantity(e,i,n=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),r=t){window.Herd.dispatchEvent(window.Herd.EVENTS.CART.BEFORE_UPDATE_ITEM_QUANTITY,{key:e,quantity:i});const d={id:e,quantity:i};try{const t=await this.cartChange(d);return n.length&&(t.sections=await window.Herd.utils.sectionRenderer.fetch(n,r)),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.AFTER_UPDATE_ITEM_QUANTITY,{state:t}),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.CHANGED,{state:t}),t}catch(t){}}async removeItem(t,e=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),i=window.location.pathname){window.Herd.dispatchEvent(window.Herd.EVENTS.CART.BEFORE_UPDATE_REMOVE_ITEM,{key:t});const n={id:t,quantity:0};this.cartError="";try{const t=await this.cartChange(n);return e.length&&(t.sections=await window.Herd.utils.sectionRenderer.fetch(e,i)),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.AFTER_UPDATE_REMOVE_ITEM,{state:t}),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.CHANGED,{state:t}),t}catch(t){}}async removeItems(t,e=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),i=window.location.pathname){for(window.Herd.dispatchEvent(window.Herd.EVENTS.CART.BEFORE_UPDATE_REMOVE_ITEM,{keys:t});t.length>0;){const n=t.shift(),r=0===t.length,d={id:n,quantity:0};try{const t=await this.cartChange(d);if(r&&e.length&&(t.sections=await window.Herd.utils.sectionRenderer.fetch(e,i)),r)return window.Herd.dispatchEvent(window.Herd.EVENTS.CART.AFTER_UPDATE_REMOVE_ITEM,{state:t}),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.CHANGED,{state:t}),t}catch(t){}}}async updateItemProperties(t,e,i=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),n=window.location.pathname){const r={id:t,properties:e};try{const t=this.cartChange(r);return i.length&&(t.sections=await window.Herd.utils.sectionRenderer.fetch(i,n)),t}catch(t){}}async updateCartAttributes(t,e=window.Herd.utils.sectionRenderer.popoutCartSections.map((t=>t.section)),i=window.location.pathname){window.Herd.dispatchEvent(window.Herd.EVENTS.CART.BEFORE_UPDATE_CART_ATTRIBUTES,{attributes:t});const n={attributes:t};try{const r=await this.cartUpdate(n);return e.length&&(r.sections=await window.Herd.utils.sectionRenderer.fetch(e,i)),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.AFTER_UPDATE_CART_ATTRIBUTES,{attributes:t}),window.Herd.dispatchEvent(window.Herd.EVENTS.CART.CHANGED,{state:r}),r}catch(t){}}cartAdd(t){return window.Herd.utils.fetchJSON(`${window.routes.cartAddUrl}`,{...window.Herd.utils.getDefaultRequestConfig(),body:JSON.stringify(t)})}cartChange(t){return window.Herd.utils.fetchJSON(`${window.routes.cartChangeUrl}`,{...window.Herd.utils.getDefaultRequestConfig(),body:JSON.stringify(t)})}cartUpdate(t){return window.Herd.utils.fetchJSON(`${window.routes.cartUpdateUrl}`,{...window.Herd.utils.getDefaultRequestConfig(),body:JSON.stringify(t)})}addVatRateToItem(t){return"properties"in t?("_vat_rate"in t.properties||(t.properties._vat_rate=window.theme.defaultVatRate),t):t}get cartError(){return this._cartError}set cartError(t){this._cartError=t;const e=document.querySelector("[data-push-cart-error]");e&&(e.textContent=t,e.style.display=t?"block":"none")}}})();