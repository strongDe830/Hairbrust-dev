{%- liquid
  assign template_name = 'section-ingredients'

  if section.settings.ingredients != blank
    assign ingredients = section.settings.ingredients
  else
    assign ingredients = shop.metaobjects.ingredient.values
  endif
  assign margin_bottom = section.settings.margin_bottom

  render 'file-css', _name: 'section-ingredients.css', _load_type: 'defer'
  render 'file-js', _name: 'section-ingredients-modal.js', _load_type: 'defer'
%}

<div
  class="{{- template_name }} u-space-below-{{- margin_bottom }}"
  data-section-type="{{- template_name -}}"
  data-section-id="{{ section.id }}"
>
  <ingredients-list class="container">
    {% content_for 'blocks' %}
    <div class="grid">
      {%- for entry in ingredients -%}
        {% liquid
          assign name_handle = entry.name | handleize
        %}
        <button class="c-btn" data-ingredients-modal-external-el="open" aria-controls="{{- name_handle -}}">
          <div class="btn-image">
            {%- if entry.image != blank -%}
              {{- entry.image | image_url: width: 80 | image_tag: alt: entry.name, loading: 'lazy' -}}
            {%- else -%}
              {{- 'image' | placeholder_svg_tag: 'placeholder-svg' -}}
            {%- endif -%}
          </div>
          <span class="u-text-md">{{- entry.name -}}</span>
          {%- render 'element-icon', _icon: 'plus' -%}
        </button>
      {%- endfor -%}
    </div>
  </ingredients-list>
</div>
<ingredients-modal class="ingredients-modal">
  <button class="c-btn close-btn" data-ingredients-modal-el="close">
    {%- render 'element-icon', _icon: 'close' -%}
  </button>
  {%- for entry in ingredients -%}
    {% liquid
      assign name_handle = entry.name | handleize
    %}
    <div class="modal-content" aria-labelledby="{{- name_handle -}}" hidden>
      {%- if entry.description_image != blank -%}
        {{-
          entry.description_image
          | image_url: width: 800
          | image_tag: widths: '400, 600, 800', alt: entry.name, loading: 'lazy'
        -}}
      {%- endif -%}
      <h3 class="u-heading-sm">{{ entry.name }}</h3>
      {{- entry.description | metafield_tag -}}
    </div>
  {%- endfor -%}
</ingredients-modal>

{% render 'overlay', _data_attributes: 'data-ingredients-modal-external-el="overlay"' %}
{% schema %}
{
  "name": "t:sections.ingredients.name",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.header_settings.content"
    },
    {
      "type": "metaobject_list",
      "id": "ingredients",
      "label": "t:sections.ingredients.settings.select_ingredients.label",
      "metaobject_type": "ingredient"
    },
    {
      "type": "select",
      "id": "margin_bottom",
      "label": "t:sections.all.spacing.margin_bottom.label",
      "options": [
        {
          "value": "none",
          "label": "t:sections.all.spacing.option_none.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.spacing.option_extra_small.label"
        },
        {
          "value": "sm",
          "label": "t:sections.all.spacing.option_small.label"
        },
        {
          "value": "md",
          "label": "t:sections.all.spacing.option_medium.label"
        },
        {
          "value": "lg",
          "label": "t:sections.all.spacing.option_large.label"
        }
      ],
      "default": "md"
    }
  ],
  "blocks": [
    {
      "type": "group-content"
    }
  ],
  "presets": [
    {
      "name": "t:sections.ingredients.name"
    }
  ]
}
{% endschema %}
