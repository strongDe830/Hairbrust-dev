{%- style -%}
  .section-categories .block-{{ block.id }} .show_container img {
    position: relative;
    height: auto;
  }

 .section-categories.block-{{ block.id }} .show_container {
    padding: 6px;
    justify-content: start;
    height: 530px;
  }

  
   @media(min-width: 1285px) {
 .section-categories .block-{{ block.id }} .show_container {
    padding: 6px;
    height: 450px;
   }

   }
{%- endstyle -%}

{% liquid
  assign product = block.settings.product
  render 'file-css', _name: 'block-group-categories.css', _load_type: 'defer'
  render 'file-css', _name: 'snippet-card-category.css', _load_type: 'defer'
  render 'file-css', _name: 'snippet-card-product-ext.css', _load_type: 'defer'
  render 'file-js', _name: 'block-group-categories.js', _load_type: 'defer'
%}

<div class="block-group-categories block-{{ block.id }}" {{ block.shopify_attributes }}>
  <group-categories class="swiper">
    <div class="swiper-wrapper">{% content_for 'blocks' %}</div>
    <div class="swiper-controls">
      <div class="swiper-pagination" data-ft-swiper-pagination></div>
      <div class="swiper-navigation">
        <button class="swiper-button-prev" aria-label="{{- 'components.swiper.previous' | t -}}" data-ft-swiper-prev>
          {%- render 'element-icon', _icon: 'slider-arrow-left' -%}
        </button>
        <button class="swiper-button-next" aria-label="{{- 'components.swiper.next' | t -}}" data-ft-swiper-next>
          {%- render 'element-icon', _icon: 'slider-arrow-right' -%}
        </button>
      </div>
    </div>
  </group-categories>
  {%- if product != blank -%}
    <div class="featured-product">
      {%- render 'card-product-ext', _product: product -%}
    </div>
  {%- endif -%}
</div>

<script>
(function () {
  const checkAndOverride = () => {
    const groupCategoriesElement = document.querySelector('group-categories');

    if (groupCategoriesElement && window.theme && window.theme.Swiper) {
      const proto = Object.getPrototypeOf(groupCategoriesElement);

      // prevent re-patching
      if (proto._patched) return;
      proto._patched = true;

      const originalInitSlider = proto.initSlider;

      proto.initSlider = function () {
        const sliderPagination = this.querySelector('[data-ft-swiper-pagination]');
        const sliderNext = this.querySelector('[data-ft-swiper-next]');
        const sliderPrev = this.querySelector('[data-ft-swiper-prev]');
        const mqlMdMax = window.matchMedia(`(max-width: ${window.theme.breakpoints.xs}px)`);
        const mqlMdMin = window.matchMedia(`(min-width: ${window.theme.breakpoints.xs}px)`);

        if (mqlMdMin.matches) {
          if (this.sliders && this.sliders.length > 0) {
            this.sliders.forEach((slider) => slider.destroy(true, true));
            this.sliders = [];
          }

          const swiper = new window.theme.Swiper(this, {
            slidesPerView: 1.2,
            spaceBetween: 8,
            slideClass: 'snippet-card-category',

            pagination: {
              el: sliderPagination,
              type: 'progressbar'
            },

            navigation: {
              nextEl: sliderNext,
              prevEl: sliderPrev,
            },

            breakpoints: {
              [window.theme.breakpoints.sm]: {
                slidesPerView: Number({{ block.settings.swiper_num_mobile | plus: 0 }}),
              },
              [window.theme.breakpoints.lg]: {
                slidesPerView: 2.5,
              },
              [window.theme.breakpoints.xl]: {
                slidesPerView: Number({{ block.settings.swiper_num_desktop | plus: 0 }}),
              },
            },
          });

          if (!this.sliders) this.sliders = [];
          this.sliders.push(swiper);
        }

        // mobile destroy
        if (mqlMdMax.matches) {
          if (this.sliders && this.sliders.length > 0) {
            this.sliders.forEach((slider) => slider.destroy(true, true));
            this.sliders = [];
          }
        }
      };

      // Trigger `initSlider` for already-rendered elements
      document.querySelectorAll('group-categories').forEach(el => el.initSlider());

    } else {
      setTimeout(checkAndOverride, 100);
    }
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkAndOverride);
  } else {
    checkAndOverride();
  }
})();

</script>

{% schema %}
{
  "name": "t:blocks.group_categories.name",
  "tag": null,
  "settings":[
    {
      "type": "product",
      "id": "product",
      "label": "t:blocks.group_categories.settings.product.label"
    },
    {
      "type": "range",
      "id": "swiper_num_desktop",
      "min": 2.5,
      "max": 6.5,
      "step": 0.5,
      "label": "Swiper items on desktop",
      "default": 3.5
    },
    {
      "type": "range",
      "id": "swiper_num_mobile",
      "min": 1.5,
      "max": 5.5,
      "step": 0.5,
      "label": "Swiper items on mobile",
      "default": 1.5
    }
  ],
  "blocks": [
    { "type": "category" },
    { "type": "page" }
  ],
  "presets": [
    {
      "name": "t:blocks.group_categories.name"
    }
  ]
}
{% endschema %}
